<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cystrix.blog.dao.UserInfoDao" >
    <sql id="tb">`user_info`</sql>
    <sql id="baseCols">
    `id`,`username`,`password`,`email`,`nickname`,`avatar`,
    `motto`,`create_time`,`update_time`,`is_delete`
    </sql>
    
    <insert id="insert" parameterType="com.cystrix.blog.dao.UserInfoDao" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO <include refid="tb"/>(<include refid="baseCols"/>)
        VALUE (NULL, #{username}, #{password}, #{email}, #{nickname}, #{avatar},
            #{motto}, #{createTime}, #{updateTime}, 0)
    </insert>

    <select id="selectUserInfoByEmail" parameterType="string" resultType="com.cystrix.blog.entity.UserInfo">
        SELECT <include refid="baseCols"/> FROM <include refid="tb"/>
        WHERE `email` = #{email} AND `is_delete` = 0
    </select>

    <select id="selectUserInfoByUsernameAndPassword" parameterType="com.cystrix.blog.entity.UserInfo" resultType="com.cystrix.blog.entity.UserInfo">
        SELECT <include refid="baseCols"/> FROM <include refid="tb"/>
        WHERE `username` = #{username} AND `password` = #{password} AND `is_delete` = 0
    </select>

    <select id="selectUserInfoByEmailAndPassword" parameterType="com.cystrix.blog.entity.UserInfo" resultType="com.cystrix.blog.entity.UserInfo">
        SELECT <include refid="baseCols"/> FROM <include refid="tb"/>
        WHERE `email` = #{email} AND `password` = #{password} AND `is_delete` = 0
    </select>

    <select id="selectUserInfoById" parameterType="integer" resultType="com.cystrix.blog.entity.UserInfo">
        SELECT <include refid="baseCols"/> FROM <include refid="tb"/>
        WHERE `id` = #{value} AND `is_delete` = 0
    </select>

    <update id="update" parameterType="com.cystrix.blog.entity.UserInfo">
        UPDATE <include refid="tb"/>
        <set>
            <if test="password != null">`password` = #{password},</if>
            <if test="email != null">`email` = #{email},</if>
            <if test="avatar != null">`avatar` = #{avatar},</if>
            <if test="motto != null">`motto` = #{motto},</if>
            <if test="nickname != null">`nickname` = #{nickname},</if>
            <if test="updateTime != null">`update_time` = #{updateTime}</if>
        </set>
        WHERE `is_delete` = 0 AND `id` = #{id}
    </update>

    <update id="deleteById" parameterType="integer">
        UPDATE <include refid="tb"/> SET `is_delete` = 1 WHERE `id` = #{id}
    </update>



</mapper>